Option Explicit

Public ScriptFileName As String

Sub Get_Data()

Dim File_Found As Boolean

ScriptFileName = "Send_req1.scpt"

File_Found = CheckAppleScriptTaskExcelScriptFile()
If File_Found = False Then End

End Sub


Function Send_req_Mac(url As String)

Dim sCmd As String

headers = "Accept: application/json, text/plain, */*" & vbCrLf & _
          "Accept-Encoding: gzip, deflate, br, zstd" & vbCrLf & _
          "Accept-Language: en-US,en;q=0.9" & vbCrLf & _
          "Connection: keep-alive" & vbCrLf & _
          "Host: rest.arbeitsagentur.de" & vbCrLf & _
          "Origin: https://web.arbeitsagentur.de" & vbCrLf & _
          "Sec-Ch-Ua: ""Google Chrome"";v=""123"", ""Not:A-Brand"";v=""8"", ""Chromium"";v=""123""" & vbCrLf & _
          "Sec-Ch-Ua-Mobile: ?0" & vbCrLf & _
          "Sec-Ch-Ua-Platform: ""Windows""" & vbCrLf & _
          "Sec-Fetch-Dest: empty" & vbCrLf & _
          "Sec-Fetch-Mode: cors" & vbCrLf & _
          "Sec-Fetch-Site: same-site" & vbCrLf & _
          "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36" & vbCrLf & _
          "X-Api-Key: infosysbub-wbsuche"

sCmd = "curl -X POST -H """ & headers & """ -H ""Content-Type: application/json"" " & url

Send_req_Mac = AppleScriptTask(ScriptFileName, "callapi3", sCmd)

End Function


Function CheckAppleScriptTaskExcelScriptFile() As Boolean

Dim AppleScriptTaskFolder As String
Dim TestStr As String

AppleScriptTaskFolder = MacScript("return POSIX path of (path to desktop folder) as string")
AppleScriptTaskFolder = Replace(AppleScriptTaskFolder, "/Desktop", "") & "Library/Application Scripts/com.microsoft.Excel/"

On Error Resume Next
TestStr = Dir(AppleScriptTaskFolder & ScriptFileName, vbDirectory)
On Error GoTo 0
If TestStr = vbNullString Then
    CheckAppleScriptTaskExcelScriptFile = False
    Call CreateAndWriteToFile(ScriptFileName)
    MsgBox ScriptFileName & " file is created and saved in the excel folder." & Chr(10) & _
                "Copy and paste the " & ScriptFileName & " file to the libabries and try again.", _
                vbExclamation, "Paste " & ScriptFileName & " in Libraries!"
   
    On Error Resume Next
        ThisWorkbook.FollowHyperlink (AppleScriptTaskFolder)
    On Error GoTo 0
    Application.StatusBar = False
Else
    CheckAppleScriptTaskExcelScriptFile = True
End If
End Function

Function CreateAndWriteToFile()

Dim filePath As String
Dim fileContent As String
Dim fileNumber As Integer

filePath = ThisWorkbook.Path & Application.PathSeparator & ScriptFileName ' Replace with your desired file path
fileContent = Support.Range("A1")
fileNumber = FreeFile
Open filePath For Output As #fileNumber
Print #fileNumber, fileContent
Close #fileNumber
End Function

'*************************
'Support.Range("A1") details give below
on callapi3(params)
    try
        set response to do shell script params
        return response
    on error errMsg
        display alert ""Error"" message errMsg
        return """"
    end try
end callapi3
'*************************
